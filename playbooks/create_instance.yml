---

- name: Cloud provider deployment
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
 
    - name: Tagged block
      block:

        - name: Deploy cloud instance
          import_role:
            name: ansible-role-create-instance

        - name: Remove existing host entry from known_hosts
          known_hosts:
            name: "{{ address['address'] }}"
            path: ~/.ssh/known_hosts
            state: absent

        - name: Refresh inventory to ensure new instances exist in inventory
          meta: refresh_inventory

      tags:
        - create

